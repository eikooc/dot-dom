<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Gotchas"><meta property="og:description" content="Gotchas Since .dom is optimized for size and not for performance nor developer friendliness, you should be aware that there are few rough edges.
Component roots cannot change The component state is preserved on it&rsquo;s root DOM element. On it&rsquo;s own turn, this element is indexed by the component&rsquo;s key.
This means, that once mounted, the component won&rsquo;t be able to change the type of the root element, since it will be persisted in the cache."><meta property="og:type" content="article"><meta property="og:url" content="https://wavesoft.github.io/dot-dom/docs/topics/gotchas/"><title>Gotchas | .dom Documentation</title><link rel=icon href=/dot-dom/favicon.png type=image/x-icon><link rel=stylesheet href=/dot-dom/book.min.1b994bd28c6ce2255f069b6bf6837b4d396307637fc48d61dcb2a6caac26e031.css integrity="sha256-G5lL0oxs4iVfBptr9oN7TTljB2N/xI1h3LKmyqwm4DE="><script defer src=/dot-dom/search.min.b134b8857012d2f57c9aad7b825eb79833044a1335ada57dbaa160a0cc6613c9.js integrity="sha256-sTS4hXAS0vV8mq17gl63mDMEShM1raV9uqFgoMxmE8k="></script><script src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js integrity="sha256-CVkji/u32aj2TeC+D13f7scFSIfphw2pmu4LaKWMSY8=" crossorigin=anonymous></script><script src=/dot-dom/js/dotdom.min.js></script><script src=/dot-dom/js/dotdom-example.js></script><link rel=stylesheet href=/dot-dom/css/styles.css></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://wavesoft.github.io/dot-dom/><span>.dom Documentation</span></a></h2><div class=book-search><input type=text placeholder=Search id=book-search-input maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Installation</span><ul><li><a href=/dot-dom/docs/install/getting-started/>Getting Started</a></li><li><a href=/dot-dom/docs/install/add-to-website/>Adding .dom in your website</a></li><li><a href=/dot-dom/docs/install/create-web-app/>Creating a WebApp</a></li><li><a href=/dot-dom/docs/install/serving-compressed/>Serving GZ version of .dom</a></li></ul></li><li><span>Topics</span><ul><li><a href=/dot-dom/docs/topics/quick-start/>Quick Start</a></li><li><a href=/dot-dom/docs/topics/declarative/>Declarative DOM</a></li><li><a href=/dot-dom/docs/topics/components/>Components</a></li><li><a href=/dot-dom/docs/topics/stateful-components/>Stateful Components</a></li><li><a href=/dot-dom/docs/topics/component-lifecycle/>Component Lifecycle</a></li><li><a href=/dot-dom/docs/topics/raw/>Raw Components</a></li><li><a href=/dot-dom/docs/topics/reconciliation/>Reconciliation</a></li><li><a href=/dot-dom/docs/topics/gotchas/ class=active>Gotchas</a></li></ul></li><li><span>API Reference</span><ul><li><a href=/dot-dom/docs/api/globals/>Globals</a></li><li><a href=/dot-dom/docs/api/component-functions/>Component Functions</a></li><li><a href=/dot-dom/docs/api/vdom-element/>VDom Element</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/dot-dom/svg/menu.svg alt=Menu></label>
<strong>Gotchas</strong></header><article class=markdown><h1 id=gotchas>Gotchas</h1><p>Since <code>.dom</code> is optimized for <em>size</em> and not for performance nor developer friendliness, you should be aware that there are few rough edges.</p><hr><h2 id=component-roots-cannot-change>Component roots cannot change</h2><p>The component state is preserved on it&rsquo;s root DOM element. On it&rsquo;s own turn, this element is indexed by the component&rsquo;s <a href=/dot-dom/docs/api/component-functions/#k-key>key</a>.</p><p>This means, that once mounted, the component won&rsquo;t be able to change the type of the root element, since it will be persisted in the cache.</p><p>For example:</p><div class=dot-dom-example><div class=view><div class=editor><div>Y29uc3QgeyBkaXYsIGEgfSA9IEg7CgpmdW5jdGlvbiBDb21wb25lbnQocHJvcHMsIHN0YXRlLCBzZXRTdGF0ZSwgbWV0YSkgewogIGNvbnN0IHJvb3QgPSBzdGF0ZS50b2dnbGUgPyAmIzM0O2VtJiMzNDsgOiAmIzM0O3N0cm9uZyYjMzQ7OwoKICByZXR1cm4gSChyb290LCAKICAgIGEoewogICAgICBocmVmOiAmIzM0O2phdmFzY3JpcHQ6OyYjMzQ7LAogICAgICBvbmNsaWNrKCkgewogICAgICAgIHNldFN0YXRlKHsKICAgICAgICAgIHRvZ2dsZTogIXN0YXRlLnRvZ2dsZQogICAgICAgIH0pCiAgICAgIH0KICAgIH0sIAogICAgc3RhdGUudG9nZ2xlCiAgICAgID8gJiMzNDtTd2l0Y2ggdG8gJmx0O3N0cm9uZyZndDsmIzM0OwogICAgICA6ICYjMzQ7U3dpdGNoIHRvICZsdDtlbSZndDsmIzM0OwogICAgKQogICkKfQoKUigKICBkaXYoCiAgICAmIzM0O1RoZSBjb21wb25lbnQgcm9vdCB3aWxsIGFsd2F5cyBiZSAmbHQ7c3Ryb25nJmd0OyAodXNlIGluc3BlY3QgdG8gdmVyaWZ5KTomIzM0OywKICAgIGRpdigKICAgICAgSChDb21wb25lbnQpCiAgICApCiAgKSwKICBkb2N1bWVudC5ib2R5Cik7</div></div><div class=preview></div></div><div class=console>Loading interactive example...</div></div><h2 id=first-setstate-locally-then-propagate>First <code>setState</code> locally, then propagate</h2><p>When in the same handler you call <code>setState</code> and <strong>also</strong> call a handler function that you received as property, make sure to call <code>setState</code> <strong>first</strong> and <strong>then</strong> call-out to the handler.</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-js data-lang=js>    <span style=color:#75715e>// First call setState
</span><span style=color:#75715e></span>    <span style=color:#a6e22e>setState</span>({ <span style=color:#a6e22e>value</span><span style=color:#f92672>:</span> <span style=color:#a6e22e>newValue</span> });
    <span style=color:#75715e>// And **then** call-out to handlers
</span><span style=color:#75715e></span>    <span style=color:#66d9ef>if</span> (<span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>onChange</span>) <span style=color:#a6e22e>props</span>.<span style=color:#a6e22e>onChange</span>();
</code></pre></div><p>That&rsquo;s due to a limitation in the internals of the <code>.dom</code> engine, that could lead into invalid state updates if the parent element updates <strong>before</strong> the child element!</p><hr><div class=topic-nav><div><div>Previous Topic</div><div><a href=https://wavesoft.github.io/dot-dom/docs/topics/reconciliation/ class=book-btn>&larr; Reconciliation</a></div></div></div></article><div class="book-footer justify-end"><div><a class="flex align-center" href=https://github.com/wavesoft/dot-dom/edit/master/docs/content/docs/topics/gotchas.md target=_blank rel=noopener><img src=/dot-dom/svg/edit.svg alt=Edit>
<span>Edit this page</span></a></div></div></div><aside class="book-toc level-6 fixed"><nav id=TableOfContents><ul><li><a href=#gotchas>Gotchas</a><ul><li><a href=#component-roots-cannot-change>Component roots cannot change</a></li><li><a href=#first-setstate-locally-then-propagate>First <code>setState</code> locally, then propagate</a></li></ul></li></ul></nav></aside></main></body></html>
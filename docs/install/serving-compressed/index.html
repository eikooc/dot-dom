<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta property="og:title" content="Serving GZ version of .dom"><meta property="og:description" content="Serving the compressed version of .dom If you want to serve .dom on it&rsquo;s smallest possible size, you might want to serve it compressed.
For example, in embedded (eg. IoT) projects the device memory is quite limited. Therefore storing the uncompressed version of the library might not be desired. In such cases, you can always serve .dom directly on it&rsquo;s compressed form.
This is achieved simply by setting the correct encoding response header while streaming the compressed library to the client:"><meta property="og:type" content="article"><meta property="og:url" content="https://wavesoft.github.io/dot-dom/docs/install/serving-compressed/"><title>Serving GZ version of .dom | .dom Documentation</title><link rel=icon href=/dot-dom/favicon.png type=image/x-icon><link rel=stylesheet href=/dot-dom/book.min.1b994bd28c6ce2255f069b6bf6837b4d396307637fc48d61dcb2a6caac26e031.css integrity="sha256-G5lL0oxs4iVfBptr9oN7TTljB2N/xI1h3LKmyqwm4DE="><script defer src=/dot-dom/search.min.b134b8857012d2f57c9aad7b825eb79833044a1335ada57dbaa160a0cc6613c9.js integrity="sha256-sTS4hXAS0vV8mq17gl63mDMEShM1raV9uqFgoMxmE8k="></script><script src=https://cdnjs.cloudflare.com/ajax/libs/ace/1.4.6/ace.js integrity="sha256-CVkji/u32aj2TeC+D13f7scFSIfphw2pmu4LaKWMSY8=" crossorigin=anonymous></script><script src=/dot-dom/js/dotdom.min.js></script><script src=/dot-dom/js/dotdom-example.js></script><link rel=stylesheet href=/dot-dom/css/styles.css></head><body><input type=checkbox class=hidden id=menu-control><main class="flex container"><aside class="book-menu fixed"><nav><h2 class=book-brand><a href=https://wavesoft.github.io/dot-dom/><span>.dom Documentation</span></a></h2><div class=book-search><input type=text placeholder=Search id=book-search-input maxlength=64><div class="book-search-spinner spinner hidden"></div><ul id=book-search-results></ul></div><ul><li><span>Installation</span><ul><li><a href=/dot-dom/docs/install/getting-started/>Getting Started</a></li><li><a href=/dot-dom/docs/install/add-to-website/>Adding .dom in your website</a></li><li><a href=/dot-dom/docs/install/create-web-app/>Creating a WebApp</a></li><li><a href=/dot-dom/docs/install/serving-compressed/ class=active>Serving GZ version of .dom</a></li></ul></li><li><span>Topics</span><ul><li><a href=/dot-dom/docs/topics/quick-start/>Quick Start</a></li><li><a href=/dot-dom/docs/topics/declarative/>Declarative DOM</a></li><li><a href=/dot-dom/docs/topics/components/>Components</a></li><li><a href=/dot-dom/docs/topics/stateful-components/>Stateful Components</a></li><li><a href=/dot-dom/docs/topics/component-lifecycle/>Component Lifecycle</a></li><li><a href=/dot-dom/docs/topics/raw/>Raw Components</a></li><li><a href=/dot-dom/docs/topics/reconciliation/>Reconciliation</a></li><li><a href=/dot-dom/docs/topics/gotchas/>Gotchas</a></li></ul></li><li><span>API Reference</span><ul><li><a href=/dot-dom/docs/api/globals/>Globals</a></li><li><a href=/dot-dom/docs/api/component-functions/>Component Functions</a></li><li><a href=/dot-dom/docs/api/vdom-element/>VDom Element</a></li></ul></li></ul></nav><script>(function(){var menu=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(event){localStorage.setItem("menu.scrollTop",menu.scrollTop);});menu.scrollTop=localStorage.getItem("menu.scrollTop");})();</script></aside><div class=book-page><header class="flex align-center justify-between book-header"><label for=menu-control><img src=/dot-dom/svg/menu.svg alt=Menu></label>
<strong>Serving GZ version of .dom</strong></header><article class=markdown><h1 id=serving-the-compressed-version-of-dom>Serving the compressed version of .dom</h1><p>If you want to serve <code>.dom</code> on it&rsquo;s smallest possible size, you might want to serve it compressed.</p><p>For example, in embedded (eg. IoT) projects the device memory is quite limited. Therefore storing the uncompressed version of the library might not be desired. In such cases, you can always serve <code>.dom</code> directly on it&rsquo;s compressed form.</p><p>This is achieved simply by setting the correct encoding response header while streaming the compressed library to the client:</p><pre><code>Content-Encoding: gzip
</code></pre><blockquote class="book-hint warning"><p>According to HTML standards you should always check the <code>Accept-Encoding</code> request header, and proceed with sending the compressed version of the library only if supported.</p><p>However <em>all</em> the browsers in the market natively support the <code>gzip</code> encoding, making this a safe assumption.</p></blockquote><hr><h2 id=esp32-example>ESP32 Example</h2><p>If you are writing a firmware for an ESP32 chip, you can directly serve the compressed version of the library, following this guide.</p><p>First, convert the compressed version of the library into a C array:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-sh data-lang=sh>cat dotdom.min.gz | xxd -i &gt;&gt; dot-dom.h</code></pre></div><p>Edit <code>dot-dom.h</code>, making sure the bytes are correctly wrapped in a static C array:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>static</span> <span style=color:#66d9ef>const</span> <span style=color:#66d9ef>uint8_t</span> DOT_DOM_JS[] <span style=color:#f92672>=</span> {
  <span style=color:#75715e>// xxd output ...
</span><span style=color:#75715e></span>  <span style=color:#ae81ff>0x1f</span>, <span style=color:#ae81ff>0x8b</span>, <span style=color:#ae81ff>0x08</span>, <span style=color:#ae81ff>0x00</span>, <span style=color:#ae81ff>0x00</span>, <span style=color:#ae81ff>0x00</span>, <span style=color:#ae81ff>0x00</span>, <span style=color:#ae81ff>0x00</span>, <span style=color:#ae81ff>0x02</span>, <span style=color:#ae81ff>0x13</span>, <span style=color:#ae81ff>0x5d</span>, <span style=color:#ae81ff>0x52</span>,
  ...
  <span style=color:#75715e>// ... up to here
</span><span style=color:#75715e></span>};
</code></pre></div><p>Then, in your HTTP handler just make sure to set the correct headers:</p><div class=highlight><pre style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-cpp data-lang=cpp><span style=color:#66d9ef>static</span> esp_err_t <span style=color:#a6e22e>handle_get_dot_dom</span>(httpd_req_t <span style=color:#f92672>*</span>req)
{
  httpd_resp_set_hdr(req, <span style=color:#e6db74>&#34;Content-Encoding&#34;</span>, <span style=color:#e6db74>&#34;gzip&#34;</span>);
  httpd_resp_set_type(req, <span style=color:#e6db74>&#34;application/javascript&#34;</span>);
  httpd_resp_send(req, DOT_DOM_JS, <span style=color:#66d9ef>sizeof</span>(DOT_DOM_JS));
  <span style=color:#66d9ef>return</span> ESP_OK;
}
</code></pre></div><hr><div class=topic-nav><div><div>Previous Topic</div><div><a href=https://wavesoft.github.io/dot-dom/docs/install/create-web-app/ class=book-btn>&larr; Creating a WebApp</a></div></div></div></article><div class="book-footer justify-end"><div><a class="flex align-center" href=https://github.com/wavesoft/dot-dom/edit/master/docs/content/docs/install/serving-compressed.md target=_blank rel=noopener><img src=/dot-dom/svg/edit.svg alt=Edit>
<span>Edit this page</span></a></div></div></div><aside class="book-toc level-6 fixed"><nav id=TableOfContents><ul><li><a href=#serving-the-compressed-version-of-dom>Serving the compressed version of .dom</a><ul><li><a href=#esp32-example>ESP32 Example</a></li></ul></li></ul></nav></aside></main></body></html>